# Deploying to Netlify - Complete Guide

## ⚠️ Important: Split Deployment Strategy

Your application has **two parts** that need to be deployed to **different platforms**:

1. **Frontend** (HTML/CSS/JS) → Deploy to **Netlify** ✅
2. **Backend** (Node.js Express server) → Deploy to **Railway/Render/Heroku** ✅

> **Why?** Netlify is for static sites only. Your backend needs a Node.js hosting platform.

---

## Step 1: Deploy Backend (Choose One Platform)

### Option A: Railway (Recommended - Free tier available)

1. **Go to [Railway.app](https://railway.app)**
2. Click "Start a New Project" → "Deploy from GitHub repo"
3. Select your repository
4. **Configure Railway:**
   - **Root Directory**: `server`
   - **Start Command**: `node server.js`
   - **Environment Variables**:
     ```
     PORT=3000
     SESSION_SECRET=your-random-secret-key-here
     NODE_ENV=production
     ALLOWED_ORIGINS=https://your-netlify-site.netlify.app
     ```
5. Deploy and copy your **Railway backend URL** (e.g., `https://your-app.up.railway.app`)

### Option B: Render.com (Free tier available)

1. **Go to [Render.com](https://render.com)**
2. Click "New" → "Web Service"
3. Connect your GitHub repository
4. **Configure:**
   - **Name**: attendance-backend
   - **Root Directory**: `server`
   - **Build Command**: `npm install`
   - **Start Command**: `node server.js`
   - **Environment Variables**: (Same as Railway above)
5. Deploy and copy your **Render backend URL**

---

## Step 2: Configure Frontend for Backend URL

Before deploying to Netlify, update your frontend to use the backend URL:

**Edit `api-client.js` (line 10-23):**

```javascript
baseUrl: (function () {
    // 1. Check if BACKEND_URL is explicitly set (for cloud deployment)
    if (window.BACKEND_URL) {
        return window.BACKEND_URL;
    }

    // 2. Localhost development
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        return 'http://localhost:3000/api';
    }

    // 3. Production - USE YOUR RAILWAY/RENDER URL HERE
    return 'https://your-backend-url.up.railway.app/api';  // ← CHANGE THIS!
})(),
```

**OR** add this to your `index.html` BEFORE the api-client.js script:

```html
<script>
    // Set backend URL for production
    window.BACKEND_URL = 'https://your-backend-url.up.railway.app/api';
</script>
<script src="api-client.js"></script>
```

---

## Step 3: Deploy Frontend to Netlify

### Method 1: Netlify Web UI (Easiest)

1. **Go to [Netlify.com](https://netlify.com)**
2. Click "Add new site" → "Import an existing project"
3. Connect your GitHub repository
4. **Configure build settings:**
   - **Base directory**: Leave empty
   - **Build command**: Leave empty (static site)
   - **Publish directory**: `.` (root directory)
5. Click "Deploy site"
6. Copy your **Netlify URL** (e.g., `https://your-site.netlify.app`)

### Method 2: Netlify CLI

```bash
# Install Netlify CLI
npm install -g netlify-cli

# Login to Netlify
netlify login

# Deploy
cd /Users/naaa/Desktop/attendance
netlify deploy --prod

# Follow prompts:
# - Create new site or link to existing
# - Publish directory: . (current directory)
```

---

## Step 4: Update Backend ALLOWED_ORIGINS

After deploying to Netlify, go back to your **backend deployment** (Railway/Render):

1. Go to Environment Variables
2. Set `ALLOWED_ORIGINS` to your Netlify URL:
   ```
   ALLOWED_ORIGINS=https://your-site.netlify.app
   ```
3. Redeploy/restart the backend

---

## Step 5: Test Your Deployment

1. **Visit your Netlify site**: `https://your-site.netlify.app`
2. **Open Developer Tools** (F12) → Console tab
3. **Look for**: `✓ API Server connected: {status: "ok", ...}`
4. **Try logging in** with the nodal credentials

---

## Troubleshooting

### ❌ "String did not match expected pattern" on Netlify

**Cause**: You're trying to deploy the server folder or set incompatible settings.

**Solution**:
- Make sure you're deploying from the **root directory**, not the `server/` folder
- The `netlify.toml` file will automatically exclude the server folder
- Don't set a build command for this static site

### ❌ "Failed to fetch" / CORS errors

**Cause**: Backend `ALLOWED_ORIGINS` doesn't match your Netlify URL.

**Solution**:
1. Check your backend logs to see what origins are allowed
2. Update `ALLOWED_ORIGINS` environment variable on Railway/Render
3. Make sure it's the EXACT Netlify URL (including `https://`)

### ❌ "Not authenticated" on login

**Cause**: Session cookies not working across domains.

**Solution**: This is expected when frontend and backend are on different domains. The session cookie configuration in `server.js` needs:
```javascript
cookie: {
    secure: true,  // HTTPS required
    httpOnly: true,
    sameSite: 'none',  // Allow cross-domain
    maxAge: 24 * 60 * 60 * 1000
}
```

---

## Summary

✅ **Frontend**: Deploy to Netlify (static files only)  
✅ **Backend**: Deploy to Railway/Render (Node.js server)  
✅ **Configure**: Update backend URL in frontend  
✅ **CORS**: Set ALLOWED_ORIGINS on backend to Netlify URL  

Your app will work with this split deployment architecture!
