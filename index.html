<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Management System</title>
    <meta name="description" content="Employee Attendance Management System with Role-Based Access Control">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="logo-circle">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <h1>Attendance System</h1>
                    <p>Employee Attendance Management Portal</p>
                </div>

                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" required autocomplete="username"
                            placeholder="Enter your username">
                    </div>

                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required autocomplete="current-password"
                            placeholder="Enter your password">
                    </div>

                    <div id="loginError" class="error-message" style="display: none;"></div>

                    <button type="submit" class="btn btn-primary">
                        <span>Sign In</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </button>
                </form>

                <div class="login-footer">
                    <p>For support, contact IT Department</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardPage" class="page">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-content">
                <div class="nav-brand">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span>Attendance System</span>
                </div>

                <div class="nav-user">
                    <span id="userDisplayName" class="user-name"></span>
                    <span id="userRole" class="user-role"></span>
                    <button id="logoutBtn" class="btn btn-secondary btn-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Logout
                    </button>
                </div>
            </div>
        </nav>

        <!-- Dashboard Content -->
        <div class="dashboard-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-menu">
                    <button class="menu-item active" data-view="attendance">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <span>Attendance</span>
                    </button>

                    <button class="menu-item" data-view="upload" id="uploadMenuItem" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <span>Upload Data</span>
                    </button>

                    <button class="menu-item" data-view="analytics" id="analyticsMenuItem" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="20" x2="12" y2="10"></line>
                            <line x1="18" y1="20" x2="18" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="16"></line>
                        </svg>
                        <span>Dashboard</span>
                    </button>

                    <button class="menu-item" data-view="reports" id="reportsMenuItem" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        <span>Reports</span>
                    </button>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- Attendance View -->
                <div id="attendanceView" class="view active">
                    <div class="view-header">
                        <div>
                            <h2>Employee Attendance</h2>
                            <p id="attendanceSubtitle">View daily attendance records</p>
                        </div>

                        <div class="header-actions">
                            <div class="date-selector">
                                <label for="dateFilter">Select Date:</label>
                                <input type="date" id="dateFilter" class="date-input">
                            </div>

                            <button id="sendMessageBtn" class="btn btn-primary" style="display: none;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M22 2L11 13"></path>
                                    <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
                                </svg>
                                Send Message
                            </button>

                            <button id="exportBtn" class="btn btn-secondary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                Export
                            </button>
                        </div>
                    </div>

                    <div class="filters-bar">
                        <div class="search-box">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input type="text" id="searchInput" placeholder="Search by name or designation...">
                        </div>

                        <select id="statusFilter" class="filter-select">
                            <option value="all">All Status</option>
                            <option value="present">Marked Attendance Only</option>
                            <option value="absent">Not Marked Attendance Only</option>
                        </select>

                        <select id="sectionFilter" class="filter-select">
                            <option value="all">All Sections</option>
                        </select>
                    </div>

                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card">
                            <div class="stat-icon stat-present">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">Marked Attendance</div>
                                <div class="stat-value" id="statPresent">0</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon stat-absent">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">Not Marked Attendance</div>
                                <div class="stat-value" id="statAbsent">0</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon stat-total">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">Total</div>
                                <div class="stat-value" id="statTotal">0</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon stat-percentage">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <line x1="19" y1="5" x2="5" y2="19"></line>
                                    <circle cx="6.5" cy="6.5" r="2.5"></circle>
                                    <circle cx="17.5" cy="17.5" r="2.5"></circle>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-label">Attendance %</div>
                                <div class="stat-value" id="statPercentage">0%</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="attendance-table" id="attendanceTable">
                            <thead id="attendanceTableHead">
                                <tr>
                                    <th>Sl. No.</th>
                                    <th>Name</th>
                                    <th>Designation</th>
                                    <th>Section</th>
                                    <th>Phone Number</th>
                                    <th>Education</th>
                                    <th>Status</th>
                                    <th>In Time</th>
                                    <th>Out Time</th>
                                    <th>Duration</th>
                                    <th>Document</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <tr class="empty-state">
                                    <td colspan="8">
                                        <div class="empty-message">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                                <line x1="3" y1="10" x2="21" y2="10"></line>
                                            </svg>
                                            <p>No attendance data available</p>
                                            <small>Please select a date or upload attendance data</small>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Upload View (Nodal Only) -->
                <div id="uploadView" class="view">
                    <div class="view-header">
                        <div>
                            <h2>Upload Attendance Data</h2>
                            <p>Upload daily attendance Excel files</p>
                        </div>
                    </div>

                    <div class="upload-container">
                        <div class="upload-dropzone" id="uploadDropzone">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            <h3>Drop attendance file here</h3>
                            <p>or click to browse</p>
                            <small>Supports: .xlsx, .xls, .csv files</small>
                            <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" multiple style="display: none;">
                        </div>

                        <div id="uploadProgress" class="upload-progress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <p id="uploadStatus">Processing...</p>
                        </div>

                        <!-- Clear All Data Section -->
                        <div class="clear-data-section">
                            <h3>⚠️ Data Management</h3>
                            <p class="text-muted">Permanently delete all attendance data from the system</p>
                            <button id="clearAllDataBtn" class="btn btn-danger" onclick="App.deleteAllData()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                                Clear All Data
                            </button>
                        </div>

                        <div id="uploadHistory" class="upload-history">
                            <h3>Upload History</h3>
                            <div id="uploadHistoryList" class="history-list"></div>
                        </div>

                        <!-- Custom Excuse Reasons Management -->
                        <div class="custom-reasons-section">
                            <h3>Manage Excuse Reasons</h3>
                            <p class="text-muted">Create custom reasons for excused absences (shown as yellow badges)
                            </p>

                            <div class="add-reason-form">
                                <input type="text" id="newReasonInput" placeholder="e.g., On Tour, Treasury Inspection"
                                    class="reason-input">
                                <button onclick="CustomStatusManager.handleAddReason()" class="btn btn-primary">Add
                                    Reason</button>
                            </div>

                            <div id="customReasonsList" class="reasons-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Analytics View (Admin/Nodal Only) -->
                <div id="analyticsView" class="view">
                    <div class="view-header">
                        <div>
                            <h2>Analytics Dashboard</h2>
                            <p>Comprehensive attendance analytics and reports</p>
                        </div>

                        <div class="header-actions">
                            <div class="date-range-selector">
                                <input type="date" id="analyticsStartDate" class="date-input">
                                <span>to</span>
                                <input type="date" id="analyticsEndDate" class="date-input">
                            </div>
                        </div>
                    </div>

                    <div class="analytics-grid">
                        <div class="chart-card chart-card-large">
                            <h3>Section-wise Attendance</h3>
                            <canvas id="sectionChart"></canvas>
                        </div>

                        <div class="chart-card full-width">
                            <h3>Daily Attendance Trend</h3>
                            <canvas id="trendChart"></canvas>
                        </div>


                        <div class="chart-card">
                            <h3>Top Performers</h3>
                            <div id="topPerformers" class="performers-list"></div>
                        </div>

                        <div class="chart-card">
                            <h3>BO-wise Statistics</h3>
                            <div id="boStats" class="bo-stats-list"></div>
                        </div>

                        <div class="chart-card">
                            <h3>Worst Performers (Most Absent)</h3>
                            <div id="worstPerformers" class="performers-list"></div>
                        </div>

                        <div class="chart-card">
                            <h3>Sections - Most Absences</h3>
                            <div id="sectionsWorstAttendance" class="section-stats-list"></div>
                        </div>

                        <div class="chart-card">
                            <h3>Sections - Best Attendance</h3>
                            <div id="sectionsBestAttendance" class="section-stats-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Reports View -->
                <div id="reportsView" class="view">
                    <div class="view-header">
                        <div>
                            <h2>Attendance Reports</h2>
                            <p>Generate comprehensive attendance analytics and PDF reports</p>
                        </div>
                    </div>

                    <div class="report-controls">
                        <!-- Date Range Selection -->
                        <div class="control-group">
                            <h3>Date Range</h3>
                            <div class="date-range-inputs">
                                <div class="form-group">
                                    <label for="reportStartDate">Start Date:</label>
                                    <input type="date" id="reportStartDate" class="date-input">
                                </div>
                                <div class="form-group">
                                    <label for="reportEndDate">End Date:</label>
                                    <input type="date" id="reportEndDate" class="date-input">
                                </div>
                            </div>
                        </div>

                        <!-- Report Type Selection -->
                        <div class="control-group">
                            <h3>Report Type</h3>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="reportType" value="failures" checked>
                                    <span>Attendance Failures</span>
                                    <small>Employees who frequently fail to mark attendance</small>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="reportType" value="performers">
                                    <span>Best Performers</span>
                                    <small>Employees with highest attendance rates</small>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="reportType" value="duration">
                                    <span>Office Duration</span>
                                    <small>Employees with longest office stays</small>
                                </label>
                            </div>
                        </div>

                        <!-- View Mode Selection (Nodal/Admin only) -->
                        <div class="control-group" id="viewModeSection">
                            <h3>View Mode</h3>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="viewMode" value="individual" checked>
                                    <span>Individual Employees</span>
                                    <small>Detailed employee-level data</small>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="viewMode" value="bo-wise">
                                    <span>BO-wise Summary</span>
                                    <small>Aggregated data by Branch Officer</small>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="report-actions">
                        <button id="generateReportBtn" class="btn btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <polyline points="16 18 22 12 16 6"></polyline>
                                <polyline points="8 6 2 12 8 18"></polyline>
                            </svg>
                            <span>Generate Report</span>
                        </button>
                        <button id="exportPdfBtn" class="btn btn-secondary" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            <span>Export PDF</span>
                        </button>
                    </div>

                    <!-- Report Preview -->
                    <div class="report-preview" id="reportPreview">
                        <div class="empty-message">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                            </svg>
                            <p>No report generated yet</p>
                            <small>Select date range and report type, then click "Generate Report"</small>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Employee Trend Modal -->
    <div id="employeeTrendModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalEmployeeName">Employee Attendance Trend</h2>
                <button class="modal-close" onclick="closeEmployeeTrendModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="employee-details">
                    <p><strong>Attendance ID:</strong> <span id="modalAttendanceId">-</span></p>
                    <p><strong>Designation:</strong> <span id="modalDesignation">-</span></p>
                    <p><strong>Section:</strong> <span id="modalSection">-</span></p>
                </div>
                <div class="attendance-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="modalTotalDays">0</div>
                        <div class="stat-label">Total Days</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="modalPresentDays">0</div>
                        <div class="stat-label">Marked Attendance Days</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="modalAttendancePercent">0%</div>
                        <div class="stat-label">Attendance %</div>
                    </div>
                </div>
                <div class="trend-chart-container">
                    <canvas id="employeeTrendChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Filter Modal -->
    <div id="customFilterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Apply Custom Filter</h2>
                <button class="modal-close" onclick="App.closeCustomFilterModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="employee-details">
                    <p><strong>Employee:</strong> <span id="filterEmployeeName">-</span></p>
                    <p><strong>Section:</strong> <span id="filterEmployeeSection">-</span></p>
                </div>

                <div class="form-group">
                    <label for="filterReasonSelect">Filter Reason:</label>
                    <select id="filterReasonSelect" class="filter-select">
                        <option value="">-- Select Reason --</option>
                    </select>
                    <small class="text-muted">Yellow highlighting will be applied to this employee</small>
                </div>

                <div class="form-group">
                    <label for="filterValidFrom">Valid From:</label>
                    <input type="date" id="filterValidFrom" class="date-input">
                    <small class="text-muted">Filter starts on this date</small>
                </div>

                <div class="form-group">
                    <label for="filterValidUntil">Valid Until (Optional):</label>
                    <input type="date" id="filterValidUntil" class="date-input">
                    <small class="text-muted">Leave empty for permanent filter, or set expiration date</small>
                </div>

                <div class="form-group">
                    <label for="filterDocumentFile">Upload PDF Document (Optional):</label>
                    <input type="file" id="filterDocumentFile" accept=".pdf" class="file-input">
                    <small class="text-muted">Max file size: 2MB</small>
                </div>

                <div class="modal-actions">
                    <button onclick="App.closeCustomFilterModal()" class="btn btn-secondary">Cancel</button>
                    <button onclick="App.applyCustomFilter()" class="btn btn-primary">Apply Filter</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Composer Modal -->
    <div id="messageComposerModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>Send Message to Employees</h2>
                <button class="modal-close" onclick="App.closeMessageComposer()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="messageFilterType">Select Recipients:</label>
                    <select id="messageFilterType" class="filter-select" onchange="App.updateMessageRecipients()">
                        <option value="">-- Select Filter --</option>
                        <option value="absent">Not Marked Attendance Employees</option>
                        <option value="present">Marked Attendance Employees</option>
                        <option value="custom_filtered"> Custom Filtered Employees</option>
                        <option value="section">Section-wise</option>
                    </select>
                </div>

                <div class="form-group" id="messageSectionGroup" style="display: none;">
                    <label for="messageSection">Select Section:</label>
                    <select id="messageSection" class="filter-select" onchange="App.updateMessageRecipients()">
                        <option value="">-- Select Section --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Recipients (<span id="recipientCount">0</span> employees):</label>
                    <div id="recipientsList" class="recipients-list"></div>
                </div>

                <div class="form-group">
                    <label for="messageContent">Message:</label>
                    <textarea id="messageContent" class="message-textarea" rows="6"
                        placeholder="Type your message here..."></textarea>
                    <small class="text-muted"><span id="messageCharCount">0</span> characters</small>
                </div>

                <div class="modal-actions">
                    <button onclick="App.closeMessageComposer()" class="btn btn-secondary">Cancel</button>
                    <button onclick="App.copyMessageList()" class="btn btn-secondary">Copy List</button>
                    <button onclick="App.downloadMessageCSV()" class="btn btn-primary">Download CSV</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    window.BACKEND_URL = 'https://attendancebytaniamishra.onrender.com/api';
    </script>
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script src="employee-mapping.js"></script>
    <script src="config.js?v=2.0"></script>
    <script src="api-client.js"></script>
    <script src="storage-manager.js"></script>
    <script src="data-processor.js"></script>
    <script src="auth-manager.js"></script>
    <script src="custom-status-manager.js"></script>
    <script src="document-manager.js"></script>
    <script src="reports-engine.js"></script>
    <script src="pdf-generator.js"></script>
    <script src="reports-view.js"></script>
    <script src="analytics.js?v=2.0"></script>
    <script src="file-uploader.js"></script>
    <script src="app.js?v=3.0"></script>
</body>

</html>
